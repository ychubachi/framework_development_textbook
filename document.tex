\documentclass[a4j,papersize]{jsbook}

\usepackage[T1]{fontenc} % LaTeXのフォントのエンコーディングをT1にする
\usepackage{textcomp} % TS1
\usepackage[utf8]{inputenc} % ファイルのエンコーディングをUTF8にする
\usepackage{lmodern}

%\usepackage{url}

\usepackage{document} % 自作書式集

\usepackage[dvipdfmx,%
 bookmarks=true,%
 bookmarksnumbered=true,%
 colorlinks=true,%
 setpagesize=false,%
 pdftitle={Javaによる抽象化プログラミング技法},%
 pdfauthor={中鉢欣秀},%
 pdfsubject={教科書},%
 pdfkeywords={Java; Object-Oriented Programing; Framework;}]{hyperref}
\usepackage{pxjahyper}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 本文
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\title{オブジェクト指向フレームワーク原論}d
\title{Javaによる抽象化プログラミング技法}
\author{中鉢 欣秀}
\begin{document}
\maketitle
% \tableofcontents

\chapter*{序}

\begin{abstract}
寿限無寿限無五劫の摺り切れ海砂利水魚の水行末雲来末風来末．食う寝る所に
住む所藪柑子ブラコウジ．パイポパイポパイポのシューリンガングーリンダイ
のポンポコピーのポンポコナーの長久命の長助．
\end{abstract}

\section*{はじめに}

この教科書はオブジェクト指向言語の抽象化機構を最短で理解できることを目
指したものである．

ソフトウェアに関連する技術の移り変わりはとても早い．変わらない知識（普遍的な知識）を身につけることこそ，ソフトウェアのアーキテクトに求められることです．

ソフトウェア・アーキテクチャに関する本質的な知識．

オブジェクト指向の概念に基づくCBD（Component Based Development）を主要なトピックとします．
フレームワークの作り方を学ぶことで，上手な使い方を体得することが目標です．

フレームワークを作れるようになろう 

他人の作ったフレームワークを使って満足するだけ
でよいのか？ 

フレームワークを使えるようになろう 

フレームワークの作り方を学ぶことによって、既存
フレームワークをより深く理解することができる 

フレームワーク・プログラミングをとりあげる
理由 

ソフトウェア開発においては、ソフトウェアを部品
化（コンポーネント化）し、部品を再利用すること
で開発効率を上げるための試みが行われてきた。 

フレームワークの構築 

原始的なIPO構造の理解から順をおって、フレーム
ワーク構築までを行ないます。 

オブジェクト指向の最も有用な利用方法の一つとし
てフレームワークとプラグインによるアーキテク
チャ設計を理解しましょう。 

汎用的な技術 

ソフトウェアにおける「構造」とは？ 

オブジェクト指向によるフレームワークの設計 

応用的な技術 

Eclipseとプラグインを活用したソフトウェア開発 

実践的なフレームワークのアーキテクチャ 

ソフトウェアの中核的構造をフレームワークとして設計す
る考え方が普及した。 

目的に応じたコンポーネントをフレームワークにプ
ラグインすることで、最も重要で複雑な中核部分の
構造を再利用できるようにする。 

こうすることにより、プログラミングにおける省力化が達
成される。


javaの約束事や決まりごとは「おまじない」または「お約束」と説明するのが
慣例です．
このテキストでは，明確にそれらの解説への参照箇所を示します．

Java言語は初心者向けの言語ではありません．ごく簡単なプログラムであって
もいわゆる「おまじない」がいっぱい出てきます．

Java仕様書

\url{http://docs.oracle.com/javase/specs/jls/se7/jls7-diffs.pdf}

IPOフレームワーク

MVCフレームワーク

\chapter{フレームワークとはなにか}

\begin{abstract}
寿限無寿限無五劫の摺り切れ海砂利水魚の水行末雲来末風来末．食う寝る所に住む所藪柑子ブラコウジ．パイポパイポパイポのシューリンガングーリンダイのポンポコピーのポンポコナーの長久命の長助．
\end{abstract}

\section{フレームワークの定義}
フレームワークの一般的な定義 

１．抽象クラスの集合とそのインスタンス間の相互
作用によって表現された，システムの全体または一
部の再利用可能な設計 

２．開発者がカスタマイズできる，アプリケーショ
ンの骨組み 

 出典） R.ジョンソン，中村宏明，中山裕子，吉田和樹著，
「パターンとフレームワーク」，共立出版 

\section{フレームワークの重要な性質}
ハリウッド・プリンシプル 

映画監督のセリフ 

「Don’t call me, I call you」 

 ハリウッドの役者は，仕事が来るのをひたすら家で待って
いなくてはならない，という例え 

フレームワークは映画監督 

フレームワークの利用者が作成するコンポーネント
は，フレームワークを呼び出すのではなく，フレー
ムワークに呼び出されるのを待つ 

\section{フレームワークに関係する用語}

\begin{figure}
 \begin{center}
  %trim option's parameter order: left bottom right top
  \includegraphics[width=0.8\textwidth, trim=30mm 30mm 35mm
  35mm,clip]{framework.pdf}
  \caption{フレームワークのアーキテクチャ例}
 \end{center}
\end{figure}

\begin{description}
 \item[コンポーネント(component)] 1つまたはそれ以上のクラスからなる,特
	    定の目的を達成するソフトウェア部品．
 \item[フレームワーク・コンポーネント(framework component)] 再利用性の
	    あるロジックをコンポーネントにしたもので,後述のプラグイン
	    コンポーネントと併用することで,様々なアプリケーションに利
	    用できるソフトウェア部品．
 \item[プラグインコンポーネント(Plug-in Component)] フレームワーク・コ
	    ンポーネントに接続することを前提としたコンポーネントで,必
	    要に応じて作成・カスタマイズできる．
 \item[プラグ・ポイント(Plug point)] コンポーネントをフレームワークに
	    プラグインするために,フレームワークが用意する接続点
\end{description}

\section{フレームワークの作り方}
フレームワークの構築へ向けて

段階を追った学習

もととなるプログラムを段階的に進化させる
方針を立て、プログラミング演習で実装する

アーキテクチャの表現と設計

Java言語の各種のOO機能を活用して、フレームワー
クを構築します

クラス/インタフェイス/メソッド/フィールド/パッ
ケージ・・・

モデル(UML)によりアーキテクチャを表現する

\section{リファクタリング・アプローチ}

ボトムアップ・アプローチについて
この授業のスタート地点
 目的の異なる2つのプログラム
フレームワーク構築への道のり
 プログラムの「アーキテクチャ」を捉える
 共通するアーキテクチャを探し出す
 共通化のための方針を立てる
 2つの「上位概念」を考える
 フレームワークを完成させる
リファクタリングとの関連
 このアプローチはリファクタリングの一種でもある

\section{ボトムアップ VS トップダウン}

以上説明したボトムアップのアプローチに対して、トップダウンのアプローチというのもある

最初から抽象度の高いアーキテクチャを「モデル」
として設計し、プログラミングで実装する

ボトムアップを採用する理由

初心者にとって学習曲線が緩やかである

実際の開発の現場でも、トップダウンとボトムアッ
プは併用する

\section{MVCパターン}

% $ pdftk フレームワーク開発特論.pdf cat 29 output MVC.pdf
\begin{figure}
 \begin{center}
  %trim option's parameter order: left bottom right top
  \includegraphics[width=0.8\textwidth, trim=25mm 70mm 60mm 30mm,clip]
   {MVC.pdf}
  \caption{MVC構造（サンプルに合わせて書き直す）}
 \end{center}
\end{figure}

MVC (Model-View-Controller)の重要性
 主にグラフィカルなインタフェースを備えたソフト
ウェアにおいて,広く一般的に利用するフレーム
ワークである
 近年では、Webアプリケーションの構築にも利用す
る
 ただし、伝統的なMVC構造とは異なっている

MVCは何に使われているのか?

GUIを含むアプリケーションの再利用技術

最初の本格的なオブジェクト指向言語である

SmallTalkで採用

MacintoshのUIでも使用

Microsoft Windowsでも採用

Webアプリケーションに適合するよう変化

MVCの構造を理解するには?

Model-View-Controllerの構造

出展)「パターンとフレームワーク」共立出版
MVCを達成するためのソースコードを書く

\subsection{フレームワークの利用}
Java言語のSwingクラスライブラリを利用した
MVC構造の実現

自ら作成したMVCの構造を、Swingクラスライブラ
リと組み合わせることで、GUIアプリケーションとし
て完成させる

\subsection{開発環境を活用したプログラミング}
どういう開発環境を使うのか?
• 「Eclipse(エクリプス)」を用いる
• 主にJava言語を用いる開発環境のスタンダード
Eclipseを利用するメリット
• Eclipseはオープンソースの開発環境であり,無料で使うことができる
• コンパイルの自動実行や,文法誤りの発見などの支援を受けることができる
• 大規模なソースコードを管理する機能がある
• 強力なリファクタリング機能
フレームワークとしてのEclipse
• Eclipseそのものがフレームワークを学ぶ教材
• さまざまな機能拡張が可能で,開発者を支援するためのソフトウェア部品が
数多く存在する

\subsection{プログラミング言語の系譜}

http://merd.sourceforge.net/pixel/language-study/diagram.html

 主要な言語
 詳細な図(150言語以上)

プログラミング言語は人の手で作られた
 Pascalを作った人
 ニクラウス・ヴィルト
 Java言語を作った人
 ジェームズ・ゴスリン
 Perlを作った人
 ラリー・ウォール
 Rubyを作った人
 まつもとゆきひろ
\section{IPOパターン}

最も単純なソフトウェアのアーキテクチャ
 IPO = Input + Process + Output
IPOとは?
 入力処理/中核となる計算処理/出力処理のこと
 株式公開(Initial Public Offering)のことではないです...
ソフトウェアのアーキテクチャの切り口
 IPOをフレームワークとして用いることができる

ソフトウェアはIPOから成り立つ．

\begin{figure}
 \begin{center}
  %trim option's parameter order: left bottom right top
  \includegraphics[width=0.8\textwidth, trim=10mm 30mm 10mm 45mm,clip]
   {IPO.pdf}
  \caption{IPOの模式図}
 \end{center}
\end{figure}

大きなIPOはさらに細かいIPO構造を含む．
最終的にはこれ以上細かくできない処理まで行き着く．

\begin{figure}
 \begin{center}
  %trim option's parameter order: left bottom right top
  \includegraphics[width=0.8\textwidth, trim=5mm 34mm 10mm 60mm,clip]
   {IPO_tree.pdf}
  \caption{IPOは階層構造になる}
 \end{center}
\end{figure}

最も細かい粒度のIPO

Input
 メモリや
 デバイス
 からデー
タを取り
 込む

Process
 CPUによ
 る演算
 処理

Output
 メモリや
 デバイス
 への
 データの
 送り込み

\section{目的手段展開について}

\begin{figure}
 \begin{center}
  %trim option's parameter order: left bottom right top
  \includegraphics[width=0.8\textwidth, trim=10mm 18mm 20mm 30mm,clip]
   {mokuteki_shudan.pdf}
  \caption{目的手段展開の構造}
 \end{center}
\end{figure}

目的型と手段型のコメント比較

コメントには「目的(何をする・What)」を書
く

「手段(どうする・How)」はコードを読めば分か
る

手段型のコメント
\begin{verbatim}
	// totalをcountで割る
	average = total / count;
\end{verbatim}

目的型のコメント
\begin{verbatim}
	// 平均点を求める
	average = total / count;
\end{verbatim}

\section{演習問題}
\begin{演習}
身近な次のソフトウェアのIPOはそれぞれなにか?
 ウェブブラウザ
 ワードプロセッサ
 メールリーダ
 データベース
 OS 
\end{演習}

\begin{演習}
「全てのソフトウェアは必ずIPOを備える」は正しいか?
\end{演習}

\begin{演習}
(InputとOutputがない)Processだけのソフトウェアには価値があるか?
\end{演習}

\begin{演習}
IPOフレームワークに基づく「プログラムの価値(=プログラが何を目的として達成する
か)」とは?
\end{演習}

\begin{演習}
 次の???にコメントを書くとしたらどうします
か?
\begin{verbatim}
	double a = 4.56;
	// ???
	int b = (int) (a + 0.5);
	System.out.println(b);
\end{verbatim}
\end{演習}
\section{解答}
\begin{解答}
 視点(領域)の設定や、
粒度によって、答えは異なる
\end{解答}

\chapter{プログラムのアーキテクチャ}

\begin{abstract}
寿限無寿限無五劫の摺り切れ海砂利水魚の水行末雲来末風来末．食う寝る所に住む所藪柑子ブラコウジ．パイポパイポパイポのシューリンガングーリンダイのポンポコピーのポンポコナーの長久命の長助．
\end{abstract}

\section{全部をmain()に書いた例)}
最近は余り見かけないが，一昔前のJava言語の入門書には最初のプログラムの
例として次のようなコードが載っていたものである．

\input{source_code/workspace/Square0/src/square/Square.java.tex}

インスタンス化について．．．

\section{割り算をするプログラム}

次のコードは，Divisionという名前のクラスを定義します．

実際に実行すると，このコードは割り算をして商と余を計算して表示します．


1行目はsquareというパッケージ宣言です（正式は？）\marginpar{パッケージ
については・・・を参照．}．

\section{コメント・ブロックによる構造の整理}
コメントによるブロックの作り方．
コメントと空行の組み合わせ．

\begin{verbatim}
private void run() throws Exception {
    // ○○を入力する
    aaa();
    bbb();

    // ○○を計算する
    ccc();

    // ○○を出力する
    ddd();
}
\end{verbatim}

それでは，次の例題を考えてみましょう．

\begin{例題}
 Divisionクラスの\texttt{run()}メソッド内のコードのうち，入力・処理・
 出力はそれぞれどれか．
\end{例題}

答えは次の通りだ．


最初のコードから変わった点
プログラムの全体構造

 Input-Process-Outputという構造が人間にとって分
かりやすい

 保守性の向上(人に優しいプログラミング)

TODO:このクラスをUMLで表現する．

\section{情報を束ねるクラス}

\section{操作を束ねるクラス}

コメントブロックの効果と問題
• プログラムのどの部分がIPOを担っているのかが明確
になった
• しかしながら,プログラムの規模が大きくなった場合,
一目で全体構造を捉えることが難しくなる
• コードが長くなるから
一目で分かるメインメソッド
• メイン関数に書いてある記述をメソッドで外部化するこ
とで,プログラムの構造をより見えやすくしよう

IPOをメソッドにする
シンプルでビューティフルなメソッドになる
 プログラムの全体の構造が一目で把握できる

\begin{verbatim}
private void run() throws Exception {
    double input = input();
    double output = process(input);
    output (output);
}
\end{verbatim}



\section{Interfaceによる抽象化}
\input{source_code/workspace/Division1/src/division/Division.java.tex}
\input{source_code/workspace/Division2/src/division/Division.java.tex}
\input{source_code/workspace/Division3/src/division/Division.java.tex}
\input{source_code/workspace/Division4/src/division/Division.java.tex}
\input{source_code/workspace/Division5/src/division/Division.java.tex}

\newpage
\section{演習問題}

\begin{演習}
 コメントブロックを用いて，このプログラムを入力・処理・出力に整理しなさ
 い．

\end{演習}

\begin{演習}
 Java言語ではクラスの名前とファイル名を一致させる必要がある．他のオブジェ
 クト指向型言語の場合を調べよ．また，クラス名とファイル名を一致させるこ
 との長所・短所について考察せよ．
\end{演習}
 

\section{パッケージとクラスの可視性}
パッケージは名前空間です．

\chapter{メモ}

\begin{enumerate}
 \item 名前付けと抽象化について（int x = 1; double pi = 3.14）
 \item テストを取り上げるか？
 \item パターンとアーキテクチャについて解説する？
 \item UMLの関連・依存関係について
 \item ライブコーディング
 \item 防衛的プログラミング
 \item interfaceとclassの使い分け
 \item 試行錯誤．あるべき設計を発見するまでに必要だったプロセスｖｓ手
       戻り
\end{enumerate}

\end{document}
